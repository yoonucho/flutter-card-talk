<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>ê°„ë‹¨í•œ Base64 UTF-8 ì¸ì½”ë”©/ë””ì½”ë”© í…ŒìŠ¤íŠ¸</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        line-height: 1.6;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      textarea {
        width: 100%;
        height: 100px;
        margin-bottom: 10px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      button {
        padding: 8px 16px;
        margin-right: 10px;
        background: #007cba;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #005a87;
      }
      .result {
        margin-top: 20px;
        padding: 10px;
        background: #f5f5f5;
        border-radius: 4px;
        word-break: break-all;
        min-height: 20px;
      }
      .success {
        background: #d4edda;
        border-left: 4px solid #28a745;
      }
      .error {
        background: #f8d7da;
        border-left: 4px solid #dc3545;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ê°„ë‹¨í•œ Base64 UTF-8 ì¸ì½”ë”©/ë””ì½”ë”© í…ŒìŠ¤íŠ¸</h1>

      <p>
        <strong
          >ì´ í…ŒìŠ¤íŠ¸ëŠ” í•œê¸€ê³¼ ì´ëª¨ì§€ë¥¼ í¬í•¨í•œ JSON ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ Base64ë¡œ
          ì¸ì½”ë”©/ë””ì½”ë”©í•©ë‹ˆë‹¤.</strong
        >
      </p>

      <h2>1. ì›ë³¸ JSON ë°ì´í„°</h2>
      <textarea id="jsonInput" placeholder="JSON ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
{"name":"í…ŒìŠ¤íŠ¸ ì¹´ë“œ","emoji":"ğŸ’Œ","message":"ì•ˆë…•í•˜ì„¸ìš”! í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ì…ë‹ˆë‹¤.","backgroundColor":"#fce4ec","textColor":"#c2185b"}</textarea
      >

      <h2>2. ì „ì²´ í”„ë¡œì„¸ìŠ¤ í…ŒìŠ¤íŠ¸</h2>
      <button onclick="runFullTest()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
      <button onclick="clearResults()">ê²°ê³¼ ì´ˆê¸°í™”</button>

      <h3>ì¸ì½”ë”© ê²°ê³¼</h3>
      <div class="result" id="encodeResult"></div>

      <h3>URL ì•ˆì „ ë³€í™˜ ê²°ê³¼</h3>
      <div class="result" id="urlSafeResult"></div>

      <h3>ë””ì½”ë”© ê²°ê³¼</h3>
      <div class="result" id="decodeResult"></div>

      <h3>JSON ê²€ì¦ ê²°ê³¼</h3>
      <div class="result" id="jsonResult"></div>
    </div>

    <script>
      // ìµœì‹  ë¸Œë¼ìš°ì € APIë¥¼ ì‚¬ìš©í•œ UTF-8 Base64 ì¸ì½”ë”©
      function utf8ToBase64(str) {
        try {
          // TextEncoderë¥¼ ì‚¬ìš©í•´ UTF-8 ë°”ì´íŠ¸ë¡œ ë³€í™˜
          const encoder = new TextEncoder();
          const data = encoder.encode(str);

          // Uint8Arrayë¥¼ ë°”ì´ë„ˆë¦¬ ë¬¸ìì—´ë¡œ ë³€í™˜
          let binary = "";
          data.forEach((byte) => {
            binary += String.fromCharCode(byte);
          });

          // Base64ë¡œ ì¸ì½”ë”©
          return btoa(binary);
        } catch (error) {
          throw new Error(`UTF-8 Base64 ì¸ì½”ë”© ì‹¤íŒ¨: ${error.message}`);
        }
      }

      // ìµœì‹  ë¸Œë¼ìš°ì € APIë¥¼ ì‚¬ìš©í•œ UTF-8 Base64 ë””ì½”ë”©
      function base64ToUtf8(base64) {
        try {
          // Base64ë¥¼ ë°”ì´ë„ˆë¦¬ ë¬¸ìì—´ë¡œ ë””ì½”ë”©
          const binary = atob(base64);

          // ë°”ì´ë„ˆë¦¬ ë¬¸ìì—´ì„ Uint8Arrayë¡œ ë³€í™˜
          const bytes = new Uint8Array(binary.length);
          for (let i = 0; i < binary.length; i++) {
            bytes[i] = binary.charCodeAt(i);
          }

          // TextDecoderë¥¼ ì‚¬ìš©í•´ UTF-8 ë¬¸ìì—´ë¡œ ë³€í™˜
          const decoder = new TextDecoder("utf-8");
          return decoder.decode(bytes);
        } catch (error) {
          throw new Error(`UTF-8 Base64 ë””ì½”ë”© ì‹¤íŒ¨: ${error.message}`);
        }
      }

      // URL ì•ˆì „ Base64 ë³€í™˜
      function makeUrlSafe(base64) {
        return base64.replace(/\+/g, "-").replace(/\//g, "_").replace(/=/g, "");
      }

      // URL ì•ˆì „ Base64ë¥¼ í‘œì¤€ Base64ë¡œ ë³µì›
      function restoreFromUrlSafe(urlSafe) {
        let base64 = urlSafe.replace(/-/g, "+").replace(/_/g, "/");
        // íŒ¨ë”© ë³µì›
        while (base64.length % 4) {
          base64 += "=";
        }
        return base64;
      }

      // ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      function runFullTest() {
        const jsonInput = document.getElementById("jsonInput").value.trim();

        if (!jsonInput) {
          showError("encodeResult", "JSON ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        try {
          // 1. JSON ìœ íš¨ì„± ê²€ì‚¬
          JSON.parse(jsonInput);

          // 2. UTF-8 Base64 ì¸ì½”ë”©
          const base64 = utf8ToBase64(jsonInput);
          showSuccess("encodeResult", `âœ… ì¸ì½”ë”© ì„±ê³µ: ${base64}`);

          // 3. URL ì•ˆì „ ë³€í™˜
          const urlSafe = makeUrlSafe(base64);
          showSuccess("urlSafeResult", `âœ… URL ì•ˆì „ ë³€í™˜: ${urlSafe}`);

          // 4. URL ì•ˆì „ Base64 ë³µì›
          const restored = restoreFromUrlSafe(urlSafe);

          // 5. UTF-8 Base64 ë””ì½”ë”©
          const decoded = base64ToUtf8(restored);
          showSuccess("decodeResult", `âœ… ë””ì½”ë”© ì„±ê³µ: ${decoded}`);

          // 6. JSON íŒŒì‹± ê²€ì¦
          const parsedJson = JSON.parse(decoded);
          showSuccess(
            "jsonResult",
            `âœ… JSON íŒŒì‹± ì„±ê³µ: ${JSON.stringify(parsedJson, null, 2)}`
          );

          // 7. ì›ë³¸ê³¼ ë¹„êµ
          if (
            JSON.stringify(JSON.parse(jsonInput)) === JSON.stringify(parsedJson)
          ) {
            console.log("âœ… ì›ë³¸ê³¼ ë³µì›ëœ ë°ì´í„°ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤!");
          } else {
            console.warn("âš ï¸ ì›ë³¸ê³¼ ë³µì›ëœ ë°ì´í„°ê°€ ë‹¤ë¦…ë‹ˆë‹¤!");
          }
        } catch (error) {
          console.error("í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:", error);
          showError("jsonResult", `âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
        }
      }

      // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
      function showSuccess(elementId, message) {
        const element = document.getElementById(elementId);
        element.className = "result success";
        element.textContent = message;
      }

      // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
      function showError(elementId, message) {
        const element = document.getElementById(elementId);
        element.className = "result error";
        element.textContent = message;
      }

      // ê²°ê³¼ ì´ˆê¸°í™”
      function clearResults() {
        ["encodeResult", "urlSafeResult", "decodeResult", "jsonResult"].forEach(
          (id) => {
            const element = document.getElementById(id);
            element.className = "result";
            element.textContent = "";
          }
        );
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
      document.addEventListener("DOMContentLoaded", function () {
        console.log(
          'í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ. í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ "ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.'
        );
      });
    </script>
  </body>
</html>
