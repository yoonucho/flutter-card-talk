<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°„ë‹¨í•œ ì¹´ë“œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: "Noto Sans KR", sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .emoji {
            font-size: 48px;
            margin-bottom: 10px;
        }
        .title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .message {
            font-size: 16px;
            white-space: pre-wrap;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ì¹´ë“œ ë””ì½”ë”© í…ŒìŠ¤íŠ¸</h1>
    
    <div>
        <h2>í…ŒìŠ¤íŠ¸ ë°ì´í„°:</h2>
        <button onclick="testCard1()">í…ŒìŠ¤íŠ¸ 1: ì‘ì› ì¹´ë“œ</button>
        <button onclick="testCard2()">í…ŒìŠ¤íŠ¸ 2: ì‚¬ë‘ ì¹´ë“œ</button>
        <button onclick="testCard3()">í…ŒìŠ¤íŠ¸ 3: ìƒì¼ ì¹´ë“œ</button>
    </div>
    
    <div id="result"></div>

    <script>
        // ê°„ë‹¨í•œ ë””ì½”ë”© í•¨ìˆ˜
        function decodeCardData(encodedData) {
            console.log("ë””ì½”ë”© ì‹œì‘:", encodedData);
            
            try {
                // 1ë‹¨ê³„: URL ë””ì½”ë”©
                let decodedData = decodeURIComponent(encodedData);
                console.log("URL ë””ì½”ë”© ì™„ë£Œ:", decodedData);
                
                // 2ë‹¨ê³„: Base64 ì •ê·œí™” (URL-safe â†’ í‘œì¤€)
                let base64String = decodedData.replace(/-/g, "+").replace(/_/g, "/");
                // íŒ¨ë”© ì¶”ê°€
                while (base64String.length % 4) {
                    base64String += "=";
                }
                console.log("Base64 ì •ê·œí™” ì™„ë£Œ:", base64String);
                
                // 3ë‹¨ê³„: Base64 â†’ UTF-8
                const binaryString = atob(base64String);
                const bytes = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                
                const decoder = new TextDecoder("utf-8");
                const jsonString = decoder.decode(bytes);
                console.log("UTF-8 ë””ì½”ë”© ì™„ë£Œ:", jsonString);
                
                // 4ë‹¨ê³„: JSON íŒŒì‹±
                const cardData = JSON.parse(jsonString);
                console.log("JSON íŒŒì‹± ì™„ë£Œ:", cardData);
                
                return cardData;
                
            } catch (error) {
                console.error("ë””ì½”ë”© ì˜¤ë¥˜:", error);
                throw new Error(`ì¹´ë“œ ë°ì´í„° ë””ì½”ë”© ì‹¤íŒ¨: ${error.message}`);
            }
        }

        function displayResult(cardData, error = null) {
            const resultDiv = document.getElementById('result');
            
            if (error) {
                resultDiv.innerHTML = `
                    <div class="test-card">
                        <div class="error">ì˜¤ë¥˜ ë°œìƒ: ${error}</div>
                    </div>
                `;
                return;
            }
            
            resultDiv.innerHTML = `
                <div class="test-card" style="background-color: ${cardData.backgroundColor || '#ffffff'}; color: ${cardData.textColor || '#000000'}">
                    <div class="emoji">${cardData.emoji || 'ğŸ’Œ'}</div>
                    <div class="title">${cardData.name || 'ì œëª© ì—†ìŒ'}</div>
                    <div class="message">${cardData.message || 'ë©”ì‹œì§€ ì—†ìŒ'}</div>
                </div>
                <div class="success">âœ… ë””ì½”ë”© ì„±ê³µ!</div>
                <pre>${JSON.stringify(cardData, null, 2)}</pre>
            `;
        }

        function testCard1() {
            // ì‘ì› ì¹´ë“œ í…ŒìŠ¤íŠ¸
            const testData = "eyJuYW1lIjoi7J2R7JuQIiwiZW1vamkiOiLwn5KqIiwibWVzc2FnZSI6IuuLueyLoOydgCDstqnrtoTtnogg7J6Y7ZWY6rOgIOyeiOyWtOyalCEg8J+SqiDtnpjrgrTshLjsmpRcblxu7ZmU7J207YyFISIsImJhY2tncm91bmRDb2xvciI6IiNlOGVhZjYiLCJ0ZXh0Q29sb3IiOiIjM2Y1MWI1In0=";
            
            try {
                const cardData = decodeCardData(testData);
                displayResult(cardData);
            } catch (error) {
                displayResult(null, error.message);
            }
        }

        function testCard2() {
            // ì‚¬ë‘ ì¹´ë“œ í…ŒìŠ¤íŠ¸ (ìƒˆë¡œ ìƒì„±)
            const testJson = JSON.stringify({
                "name": "ì‚¬ë‘ ê³ ë°±",
                "emoji": "ğŸ’•",
                "message": "ë‹¹ì‹ ì„ ì‚¬ë‘í•©ë‹ˆë‹¤.\n\ní•¨ê»˜í•˜ëŠ” ëª¨ë“  ìˆœê°„ì´ í–‰ë³µí•´ìš”! ğŸ’•",
                "backgroundColor": "#FFE4E6",
                "textColor": "#E91E63"
            });
            
            // UTF-8 â†’ Base64 ì¸ì½”ë”©
            const encoder = new TextEncoder();
            const utf8Bytes = encoder.encode(testJson);
            let binaryString = "";
            utf8Bytes.forEach(byte => {
                binaryString += String.fromCharCode(byte);
            });
            const encoded = btoa(binaryString);
            
            console.log("ìƒˆë¡œ ìƒì„±í•œ Base64:", encoded);
            
            try {
                const cardData = decodeCardData(encoded);
                displayResult(cardData);
            } catch (error) {
                displayResult(null, error.message);
            }
        }

        function testCard3() {
            // ìƒì¼ ì¹´ë“œ í…ŒìŠ¤íŠ¸ (ìƒˆë¡œ ìƒì„±)
            const testJson = JSON.stringify({
                "name": "ìƒì¼ ì¶•í•˜",
                "emoji": "ğŸ‚",
                "message": "ìƒì¼ ì¶•í•˜í•´ìš”! ğŸ‰\n\ní–‰ë³µí•œ í•˜ë£¨ ë˜ì„¸ìš”!",
                "backgroundColor": "#E8F5E8",
                "textColor": "#2E7D32"
            });
            
            // UTF-8 â†’ Base64 ì¸ì½”ë”©
            const encoder = new TextEncoder();
            const utf8Bytes = encoder.encode(testJson);
            let binaryString = "";
            utf8Bytes.forEach(byte => {
                binaryString += String.fromCharCode(byte);
            });
            const encoded = btoa(binaryString);
            
            console.log("ìƒˆë¡œ ìƒì„±í•œ Base64:", encoded);
            
            try {
                const cardData = decodeCardData(encoded);
                displayResult(cardData);
            } catch (error) {
                displayResult(null, error.message);
            }
        }
    </script>
</body>
</html>